<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>JointRcppML â€¢ Joint.RcppML</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="JointRcppML">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Joint.RcppML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/JointRcppML.html">JointRcppML</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>JointRcppML</h1>
            
      

      <div class="d-none name"><code>JointRcppML.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Joint.RcppML</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; Loading required package: RcppML</span></span>
<span><span class="co">#&gt; RcppML v0.5.5 using 'options(RcppML.threads = 0)' (all available threads), 'options(RcppML.verbose = FALSE)'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'RcppML::head' by 'utils::head' when loading</span></span>
<span><span class="co">#&gt; 'Joint.RcppML'</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-in-the-example-data">Load in the example data<a class="anchor" aria-label="anchor" href="#load-in-the-example-data"></a>
</h2>
<p>This is a very small subset of data from the TCGA-COAD PanCancer
Atlas for easy loading. The full example dataset can be loaded from the
ExampleJointRcppML package, but the files are quite large. Input files
should be pre-processed as is appropriate for the data type.</p>
<p>In this case, the Methylation 450k array data is the Beta values
after removal of probes missing &gt;2% of values and imputation of
remaining missing values so that there are no NA values. RNAseq data was
processed with vst normalization using DESeq2.</p>
<p>This Joint NMF workflow is intended for use with multi-omic data with
<strong>partially shared samples</strong>, meaning that a subset of
samples are present in both data sets. All features within the two data
types should be distinct.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Betas</span><span class="op">&lt;-</span> <span class="va">TCGA_COAD_Betas_subset</span></span>
<span></span>
<span><span class="va">RNA</span><span class="op">&lt;-</span> <span class="va">TCGA_COAD_vst_RNAseq_subset</span></span>
<span></span>
<span><span class="va">metadata</span><span class="op">&lt;-</span> <span class="va">TCGA_COAD_metadata</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="integrate-and-weight-data">Integrate and Weight data<a class="anchor" aria-label="anchor" href="#integrate-and-weight-data"></a>
</h2>
<p>The purpose of this function is to join the two datasets and weight
them appropriately. Column normalization is optional and applied to each
dataset independently, prior to weighting. In this case it is applied to
the Beta values so that samples with global hypomethylation are given
the same weight in the NMF model as all other samples. Following column
normalization, the weights are determined by calculating the
transformation needed to make the total sum of data1 equivalent to the
total sum of data2 for the shared samples.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_and_weight.html">integrate_and_weight</a></span><span class="op">(</span><span class="va">Betas</span>, <span class="va">RNA</span>, normalize_data1 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the matrix and sparse matrix objects from the output</span></span>
<span><span class="va">combined_matrix</span><span class="op">&lt;-</span> <span class="va">input</span><span class="op">[[</span><span class="st">"combined_matrix"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">sparse_matrix</span><span class="op">&lt;-</span> <span class="va">input</span><span class="op">[[</span><span class="st">"sparse_matrix"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cross-validate-to-determine-the-number-of-nmf-components">Cross validate to determine the number of NMF components<a class="anchor" aria-label="anchor" href="#cross-validate-to-determine-the-number-of-nmf-components"></a>
</h2>
<p>This is a modification of the crossValidate function from the RcppML
package and can accept all arguments from RcppML::nmf. This version will
work with data that contains NA values, as will always be the case for
data used for Joint NMF analysis. It creates an additional mask for the
NA values separately from the randomly masked values that are used for
model evaluation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CV</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/joint_crossValidate.html">joint_crossValidate</a></span><span class="op">(</span><span class="va">sparse_matrix</span>, k<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, reps<span class="op">=</span><span class="fl">4</span>, n<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in Matrix.DeprecatedCoerce(cd1, cd2): 'as(&lt;matrix&gt;, "ngCMatrix")' is deprecated.</span></span>
<span><span class="co">#&gt; Use 'as(as(as(., "nMatrix"), "generalMatrix"), "CsparseMatrix")' instead.</span></span>
<span><span class="co">#&gt; See help("Deprecated") and help("Matrix-deprecated").</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">CV</span><span class="op">)</span></span></code></pre></div>
<p><img src="JointRcppML_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="run-nmf-using-the-rcppml-package">Run NMF using the RcppML package<a class="anchor" aria-label="anchor" href="#run-nmf-using-the-rcppml-package"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">&lt;-</span> <span class="fu">RcppML</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppML/man/nmf.html" class="external-link">nmf</a></span><span class="op">(</span><span class="va">sparse_matrix</span>, k <span class="op">=</span> <span class="fl">6</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, tol <span class="op">=</span> <span class="fl">1e-6</span>, mask <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in RcppML::nmf(sparse_matrix, k = 6, seed = 1:3, tol = 1e-06, mask =</span></span>
<span><span class="co">#&gt; "NA"): NA values were detected in the data. Setting "mask = 'NA'"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="merge-metadata">Merge metadata<a class="anchor" aria-label="anchor" href="#merge-metadata"></a>
</h2>
<p>In this example case we only have one set of metadata, however this
function is also designed to work for situations where metadata for each
data type is stored in separate dataframes. It takes all the hassle out
of trying to join, clean, and align metadata labels of interest for
downstream analysis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">labels</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_metadata.html">merge_metadata</a></span><span class="op">(</span><span class="va">metadata</span>, <span class="va">metadata</span>, <span class="st">"SampleID"</span>, <span class="va">combined_matrix</span>, </span>
<span>                        metadata_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Purity"</span>, <span class="st">"Location"</span>, <span class="st">"Age"</span>, <span class="st">"Active_Driver"</span>, </span>
<span>                                             <span class="st">"DNA_Methylation_Category_String"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-the-plot-functionality-as-demonstrated-in-the-rcppml-package">Use the plot functionality as demonstrated in the RcppML
package<a class="anchor" aria-label="anchor" href="#use-the-plot-functionality-as-demonstrated-in-the-rcppml-package"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmf_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span>, group_by <span class="op">=</span> <span class="va">labels</span><span class="op">[[</span><span class="st">"Active_Driver"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmf_group</span>, stat <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span></code></pre></div>
<p><img src="JointRcppML_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">nmf_group2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span>, group_by <span class="op">=</span> <span class="va">labels</span><span class="op">[[</span><span class="st">"DNA_Methylation_Category_String"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmf_group2</span>, stat <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span></code></pre></div>
<p><img src="JointRcppML_files/figure-html/unnamed-chunk-7-2.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="make-a-umap-of-the-nmf-factors">Make a UMAP of the NMF factors<a class="anchor" aria-label="anchor" href="#make-a-umap-of-the-nmf-factors"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_umap</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/nmf_umap.html">nmf_umap</a></span><span class="op">(</span><span class="va">model</span>, group_labels <span class="op">=</span> <span class="va">labels</span><span class="op">[[</span><span class="st">"DNA_Methylation_Category_String"</span><span class="op">]</span><span class="op">]</span>, n_neighbors<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">my_umap</span></span></code></pre></div>
<p><img src="JointRcppML_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="heatmap-of-sample-weights">Heatmap of Sample Weights<a class="anchor" aria-label="anchor" href="#heatmap-of-sample-weights"></a>
</h2>
<p>This function uses pheatmap to visualize the sample weights from the
H matrix of the NMF output. You can customize it using any of the<br>
standard pheatmap arguments, and easily pass in metadata labels for
sample annotations.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/H_heatmap.html">H_heatmap</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>          group_labels <span class="op">=</span> <span class="va">labels</span>, </span>
<span>          group_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                              DNA_Methylation_Category_String<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CIMP-H"</span><span class="op">=</span><span class="st">"orange"</span>, <span class="st">"CRC CIMP-L"</span><span class="op">=</span><span class="st">"green"</span>, </span>
<span>                                                                <span class="st">"Non-CIMP"</span><span class="op">=</span><span class="st">"skyblue"</span><span class="op">)</span>, </span>
<span>                              Location<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cecum"</span><span class="op">=</span><span class="st">"tan"</span>, <span class="st">"Colon"</span><span class="op">=</span><span class="st">"tan4"</span><span class="op">)</span>, </span>
<span>                              Active_Driver<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Apc"</span><span class="op">=</span><span class="st">"yellow"</span>, <span class="st">"Braf"</span><span class="op">=</span><span class="st">"red"</span>, <span class="st">"Braf_w_other"</span><span class="op">=</span><span class="st">"hotpink"</span>, </span>
<span>                                              <span class="st">"Kras"</span><span class="op">=</span><span class="st">"limegreen"</span>, <span class="st">"Kras_w_other"</span><span class="op">=</span><span class="st">"palegreen"</span>, </span>
<span>                                              <span class="st">"Smad4"</span><span class="op">=</span><span class="st">"steelblue1"</span>, <span class="st">"Tp53"</span><span class="op">=</span><span class="st">"purple"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="JointRcppML_files/figure-html/unnamed-chunk-9-1.png" width="1056"></p>
</div>
<div class="section level2">
<h2 id="top-features">Top Features<a class="anchor" aria-label="anchor" href="#top-features"></a>
</h2>
<p>Pull out the top features from the W matrix for each NMF component.
This can also set you up for easy downstream enrichment analyses by
getting<br>
the top features for each data type.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Top_features</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/topFeatures.html">topFeatures</a></span><span class="op">(</span><span class="va">model</span>, n<span class="op">=</span><span class="fl">50</span>, filter_dfs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Betas</span>, <span class="va">RNA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Top_features</span><span class="op">[[</span><span class="st">"nmf1_df1"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "cg00021978" "cg00007239" "cg00012317" "cg00028598" "cg00008695"</span></span>
<span><span class="co">#&gt;  [6] "cg00005740" "cg00015340" "cg00029246" "cg00019841" "cg00026141"</span></span>
<span><span class="co">#&gt; [11] "cg00009922" "cg00022145" "cg00003529" "cg00021242" "cg00005166"</span></span>
<span><span class="co">#&gt; [16] "cg00018850" "cg00026938" "cg00004773" "cg00018696" "cg00013618"</span></span>
<span><span class="co">#&gt; [21] "cg00021550" "cg00012529" "cg00026776" "cg00012698" "cg00013196"</span></span>
<span><span class="co">#&gt; [26] "cg00019997" "cg00016127" "cg00025715" "cg00019877" "cg00016406"</span></span>
<span><span class="co">#&gt; [31] "cg00009750" "cg00016481" "cg00016360" "cg00007326" "cg00023411"</span></span>
<span><span class="co">#&gt; [36] "cg00000948" "cg00020533" "cg00001446" "cg00013006" "cg00019511"</span></span>
<span><span class="co">#&gt; [41] "cg00015930" "cg00013349" "cg00005215" "cg00020419" "cg00001791"</span></span>
<span><span class="co">#&gt; [46] "cg00019678" "cg00019151" "cg00018204" "cg00023351" "cg00003181"</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mary Olesnavich.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
